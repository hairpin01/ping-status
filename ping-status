#!/usr/bin/env python3

import os
import sys
import subprocess
import configparser
import argparse
import urllib.request
import tempfile
import hashlib
import json
import shutil
import importlib.util
import re
from pathlib import Path
from datetime import datetime

__version__ = "3.3.0"
__author__ = "hairpin01"

# URLs –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
RAW_INSTALL = "https://raw.githubusercontent.com/hairpin01/ping-status/refs/heads/main/install.sh"
RAW_SCRIPT = "https://raw.githubusercontent.com/hairpin01/ping-status/refs/heads/main/ping-status"
RAW_CONFIG = "https://raw.githubusercontent.com/hairpin01/ping-status/refs/heads/main/ping_status.conf"
THEMES_BASE_URL = "https://raw.githubusercontent.com/hairpin01/ping-status/refs/heads/main/theme/"
PLUGINS_BASE_URL = "https://raw.githubusercontent.com/hairpin01/ping-status/refs/heads/main/plugins/"

def version_check(required_version, component_name="component"):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π"""
    current_parts = list(map(int, __version__.split('.')))
    required_parts = list(map(int, required_version.split('.')))
    
    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏–∏
    for i in range(max(len(current_parts), len(required_parts))):
        current = current_parts[i] if i < len(current_parts) else 0
        required = required_parts[i] if i < len(required_parts) else 0
        
        if current < required:
            print_colored(f"‚ùå {component_name} requires ping-status v{required_version}+ (you have v{__version__})", 'red')
            return False
        elif current > required:
            break
    
    return True

def get_color_code(color):
    """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ —Ü–≤–µ—Ç–∞ –¥–ª—è ANSI escape sequences"""
    colors = {
        'black': '30',
        'red': '31',
        'green': '32',
        'yellow': '33',
        'blue': '34',
        'magenta': '35',
        'cyan': '36',
        'white': '37',
        'reset': '0'
    }
    
    # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HEX —Ü–≤–µ—Ç–æ–≤ (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
    if color.startswith('#'):
        # –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HEX –≤ –±–ª–∏–∂–∞–π—à–∏–π ANSI —Ü–≤–µ—Ç
        hex_color = color.lstrip('#').lower()
        if hex_color in ['ff0000', 'ff5555', 'ff6b6b']:
            return '31'  # red
        elif hex_color in ['00ff00', '55ff55', '6bff6b']:
            return '32'  # green
        elif hex_color in ['ffff00', 'ffff55', 'ffff6b']:
            return '33'  # yellow
        elif hex_color in ['0000ff', '5555ff', '6b6bff']:
            return '34'  # blue
        elif hex_color in ['ff00ff', 'ff55ff', 'ff6bff']:
            return '35'  # magenta
        elif hex_color in ['00ffff', '55ffff', '6bffff']:
            return '36'  # cyan
        else:
            return '37'  # white
    
    return colors.get(color.lower(), '37')

def colorize(text, color):
    """–¶–≤–µ—Ç–æ–≤–æ–π –≤—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞"""
    return f'\033[{get_color_code(color)}m{text}\033[0m'

def print_colored(text, color='white'):
    print(colorize(text, color))

def parse_color_commands(text, data_dict):
    """–ü–∞—Ä—Å–∏–Ω–≥ —Ü–≤–µ—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ —Ç–µ–∫—Å—Ç–µ"""
    # –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ {color:(—Ç–µ–∫—Å—Ç) "—Ü–≤–µ—Ç"}
    pattern = r'\{color:\(([^)]+)\)\s*"([^"]+)"\}'
    
    def replace_color(match):
        content = match.group(1).strip()
        color = match.group(2).strip()
        
        # –ï—Å–ª–∏ content —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–æ–º –≤ data_dict, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ
        if content in data_dict:
            content_value = str(data_dict[content])
        else:
            content_value = content
        
        return colorize(content_value, color)
    
    return re.sub(pattern, replace_color, text)

def apply_global_colors(text, global_color):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –∫–æ –≤—Å–µ–º—É —Ç–µ–∫—Å—Ç—É"""
    if not global_color:
        return text
    
    # –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
    lines = text.split('\n')
    colored_lines = []
    
    for i, line in enumerate(lines):
        if global_color == "rainbow":
            # –†–∞–¥—É–∂–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            colored_line = ""
            colors = ['red', 'yellow', 'green', 'cyan', 'blue', 'magenta']
            for j, char in enumerate(line):
                color = colors[(i + j) % len(colors)]
                colored_line += colorize(char, color)
            colored_lines.append(colored_line)
        elif global_color == "gradient-vertical":
            # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç (—Å–≤–µ—Ä—Ö—É –∫—Ä–∞—Å–Ω—ã–π, —Å–Ω–∏–∑—É –∑–µ–ª–µ–Ω—ã–π)
            total_lines = len(lines)
            if total_lines > 1:
                # –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ–º –æ—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ –∫ –∑–µ–ª–µ–Ω–æ–º—É
                ratio = i / (total_lines - 1) if total_lines > 1 else 0
                if ratio < 0.5:
                    # –û—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ –∫ –∂–µ–ª—Ç–æ–º—É
                    color_ratio = ratio * 2
                    if color_ratio < 0.33:
                        color = 'red'
                    elif color_ratio < 0.66:
                        color = 'yellow'
                    else:
                        color = 'green'
                else:
                    # –û—Ç –∂–µ–ª—Ç–æ–≥–æ –∫ –∑–µ–ª–µ–Ω–æ–º—É
                    color_ratio = (ratio - 0.5) * 2
                    if color_ratio < 0.5:
                        color = 'yellow'
                    else:
                        color = 'green'
                colored_lines.append(colorize(line, color))
            else:
                colored_lines.append(colorize(line, 'yellow'))
        elif global_color == "gradient-horizontal":
            # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç (—Å–ª–µ–≤–∞ –∑–µ–ª–µ–Ω—ã–π, —Å–ø—Ä–∞–≤–∞ –∫—Ä–∞—Å–Ω—ã–π)
            colored_line = ""
            line_length = len(line)
            for j, char in enumerate(line):
                ratio = j / line_length if line_length > 0 else 0
                if ratio < 0.5:
                    # –û—Ç –∑–µ–ª–µ–Ω–æ–≥–æ –∫ –∂–µ–ª—Ç–æ–º—É
                    color_ratio = ratio * 2
                    if color_ratio < 0.33:
                        color = 'green'
                    elif color_ratio < 0.66:
                        color = 'yellow'
                    else:
                        color = 'red'
                else:
                    # –û—Ç –∂–µ–ª—Ç–æ–≥–æ –∫ –∫—Ä–∞—Å–Ω–æ–º—É
                    color_ratio = (ratio - 0.5) * 2
                    if color_ratio < 0.5:
                        color = 'yellow'
                    else:
                        color = 'red'
                colored_line += colorize(char, color)
            colored_lines.append(colored_line)
        else:
            # –û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç
            colored_lines.append(colorize(line, global_color))
    
    return '\n'.join(colored_lines)

def get_ping(host):
    try:
        result = subprocess.run(
            ['ping', '-c', '1', '-W', '1', host],
            capture_output=True,
            text=True,
            timeout=3
        )
        if result.returncode == 0:
            time_line = [line for line in result.stdout.split('\n') if 'time=' in line][0]
            ping_time = time_line.split('time=')[1].split(' ')[0]
            return ping_time
        return "unreachable"
    except:
        return "timeout"

def get_uptime():
    try:
        with open('/proc/uptime', 'r') as f:
            uptime_seconds = float(f.readline().split()[0])
        
        days = int(uptime_seconds // 86400)
        hours = int((uptime_seconds % 86400) // 3600)
        minutes = int((uptime_seconds % 3600) // 60)
        
        if days > 0:
            return f"{days}d {hours}h {minutes}m"
        elif hours > 0:
            return f"{hours}h {minutes}m"
        else:
            return f"{minutes}m"
    except:
        return "unknown"

def load_config():
    config_path = Path.home() / '.config' / 'ping-status.conf'
    
    if not config_path.exists():
        config_path = Path('/etc/ping-status.conf')
    
    config = configparser.ConfigParser()
    config.read(config_path)
    
    host = config.get('settings', 'host', fallback='google.com')
    template = config.get('settings', 'text', fallback='Ping: {ping}\nUptime: {uptime}\nUser: {user}\nHostname: {hostname}')
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞
    ping_color = config.get('colors', 'ping', fallback='green')
    uptime_color = config.get('colors', 'uptime', fallback='yellow')
    user_color = config.get('colors', 'user', fallback='blue')
    hostname_color = config.get('colors', 'hostname', fallback='cyan')
    
    # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞
    global_color = config.get('colors-plus', 'global', fallback='')
    background_color = config.get('colors-plus', 'background', fallback='')
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤
    plugins_enabled = config.get('plugins', 'enabled', fallback='system-info,weather').split(',')
    
    return {
        'host': host,
        'template': template,
        'colors': {
            'ping': ping_color,
            'uptime': uptime_color,
            'user': user_color,
            'hostname': hostname_color
        },
        'colors_plus': {
            'global': global_color,
            'background': background_color
        },
        'plugins_enabled': [p.strip() for p in plugins_enabled]
    }

def load_plugins():
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –ø–ª–∞–≥–∏–Ω—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤"""
    config = load_config()
    plugins_dir = Path.home() / '.config' / 'ping-status' / 'plugins'
    plugins_dir.mkdir(parents=True, exist_ok=True)
    
    plugins_data = {}
    loaded_plugins = []
    
    for plugin_file in plugins_dir.glob('*.py'):
        plugin_name = plugin_file.stem
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ –ø–ª–∞–≥–∏–Ω –≤ –∫–æ–Ω—Ñ–∏–≥–µ
        enabled_plugins = [p.replace('.plugin', '') for p in config['plugins_enabled']]
        if plugin_name not in enabled_plugins and 'all' not in config['plugins_enabled']:
            continue
            
        try:
            # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞
            spec = importlib.util.spec_from_file_location(plugin_name, plugin_file)
            plugin_module = importlib.util.module_from_spec(spec)
            spec.loader.exec_module(plugin_module)
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø–ª–∞–≥–∏–Ω–∞
            if hasattr(plugin_module, '__min_version__'):
                if not version_check(plugin_module.__min_version__, f"Plugin '{plugin_name}'"):
                    continue
            
            # –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ register –ø–ª–∞–≥–∏–Ω–∞
            if hasattr(plugin_module, 'register'):
                plugin_data = plugin_module.register()
                if isinstance(plugin_data, dict):
                    plugins_data.update(plugin_data)
                    loaded_plugins.append(plugin_name)
                else:
                    print_colored(f"‚ùå –ü–ª–∞–≥–∏–Ω {plugin_name} –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç", 'yellow')
            else:
                print_colored(f"‚ùå –ü–ª–∞–≥–∏–Ω {plugin_name} –Ω–µ –∏–º–µ–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ register", 'yellow')
                
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ {plugin_name}: {e}", 'red')
    
    return plugins_data

def show_status():
    config = load_config()
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    ping_value = get_ping(config['host'])
    uptime_value = get_uptime()
    user_value = os.getlogin()
    hostname_value = subprocess.run(['hostname'], capture_output=True, text=True).stdout.strip()
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
    plugins_data = load_plugins()
    
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏
    all_data = {
        'ping': ping_value,
        'uptime': uptime_value,
        'user': user_value,
        'hostname': hostname_value
    }
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–ª–∞–≥–∏–Ω–æ–≤
    for key, value in plugins_data.items():
        all_data[key] = value
    
    # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω
    template = config['template']
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ü–≤–µ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
    template = parse_color_commands(template, all_data)
    
    # –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —à–∞–±–ª–æ–Ω
    output = template
    for key, value in all_data.items():
        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ–ª–µ–π
        if key in config['colors']:
            color = config['colors'][key]
            value = colorize(value, color)
        output = output.replace(f'{{{key}}}', str(value))
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞
    global_color = config['colors_plus']['global']
    if global_color:
        output = apply_global_colors(output, global_color)
    
    print(output)

def download_file(url, dest_path):
    """–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ URL"""
    try:
        with urllib.request.urlopen(url) as response:
            content = response.read()
            with open(dest_path, 'wb') as f:
                f.write(content)
        return True
    except Exception as e:
        print_colored(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ {url}: {e}", 'red')
        return False

def get_remote_version():
    """–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"""
    try:
        with urllib.request.urlopen(RAW_SCRIPT) as response:
            content = response.read().decode('utf-8')
            for line in content.split('\n'):
                if line.startswith('__version__'):
                    return line.split('=')[1].strip().strip("'\"")
    except:
        pass
    return None

def check_update():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"""
    print_colored("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...", 'yellow')
    
    remote_version = get_remote_version()
    if not remote_version:
        print_colored("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è", 'red')
        return False
    
    print_colored(f"–õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: {__version__}", 'blue')
    print_colored(f"–£–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: {remote_version}", 'blue')
    
    if remote_version != __version__:
        print_colored("‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!", 'green')
        return True
    else:
        print_colored("‚úÖ –£ –≤–∞—Å –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è", 'green')
        return False

def perform_update():
    """–í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"""
    print_colored("üîÑ –ù–∞—á–∞–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...", 'yellow')
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
    if os.geteuid() != 0:
        print_colored("‚ùå –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo.", 'red')
        return False
    
    # –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
    with tempfile.TemporaryDirectory() as temp_dir:
        temp_script = os.path.join(temp_dir, 'ping-status')
        temp_config = os.path.join(temp_dir, 'ping-status.conf')
        
        # –°–∫–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
        print_colored("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞...", 'yellow')
        if not download_file(RAW_SCRIPT, temp_script):
            return False
        
        # –°–∫–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥
        print_colored("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞...", 'yellow')
        if not download_file(RAW_CONFIG, temp_config):
            return False
        
        # –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
        os.chmod(temp_script, 0o755)
        
        # –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
        print_colored("üíæ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π...", 'yellow')
        backup_dir = Path('/tmp/ping-status-backup')
        backup_dir.mkdir(exist_ok=True)
        
        script_path = Path('/usr/local/bin/ping-status')
        config_path = Path('/etc/ping-status.conf')
        
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å copy2 –≤–º–µ—Å—Ç–æ rename –¥–ª—è –∫—Ä–æ—Å—Å-—Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
        if script_path.exists():
            shutil.copy2(str(script_path), str(backup_dir / 'ping-status.backup'))
        if config_path.exists():
            shutil.copy2(str(config_path), str(backup_dir / 'ping-status.conf.backup'))
        
        # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        print_colored("‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤...", 'yellow')
        try:
            # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
            shutil.copy2(temp_script, '/usr/local/bin/ping-status')
            os.chmod('/usr/local/bin/ping-status', 0o755)
            
            # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
            shutil.copy2(temp_config, '/etc/ping-status.conf')
            
            # –û–±–Ω–æ–≤–∏—Ç—å —Å–∏–º–ª–∏–Ω–∫
            symlink_path = Path('/usr/local/bin/p')
            if symlink_path.exists():
                symlink_path.unlink()
            symlink_path.symlink_to('/usr/local/bin/ping-status')
            
            print_colored("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!", 'green')
            print_colored(f"üìÅ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: {backup_dir}", 'blue')
            return True
            
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ: {e}", 'red')
            
            # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
            print_colored("üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...", 'yellow')
            backup_script = backup_dir / 'ping-status.backup'
            backup_config = backup_dir / 'ping-status.conf.backup'
            
            try:
                if backup_script.exists():
                    shutil.copy2(str(backup_script), '/usr/local/bin/ping-status')
                    os.chmod('/usr/local/bin/ping-status', 0o755)
                if backup_config.exists():
                    shutil.copy2(str(backup_config), '/etc/ping-status.conf')
                
                print_colored("‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ", 'green')
            except Exception as restore_error:
                print_colored(f"‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: {restore_error}", 'red')
                print_colored("‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞", 'yellow')
            
            return False

def uninstall():
    """–£–¥–∞–ª–∏—Ç—å ping-status"""
    print_colored("üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ ping-status...", 'yellow')
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
    if os.geteuid() != 0:
        print_colored("‚ùå –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo.", 'red')
        return False
    
    files_to_remove = [
        '/usr/local/bin/ping-status',
        '/usr/local/bin/p',
        '/etc/ping-status.conf'
    ]
    
    user_config = Path.home() / '.config' / 'ping-status.conf'
    plugins_dir = Path.home() / '.config' / 'ping-status' / 'plugins'
    
    print_colored("–°–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã:", 'red')
    for file in files_to_remove:
        if os.path.exists(file):
            print_colored(f"  - {file}", 'red')
    
    if user_config.exists():
        print_colored(f"  - {user_config} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥)", 'red')
    
    if plugins_dir.exists():
        print_colored(f"  - {plugins_dir} (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤)", 'red')
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    try:
        confirm = input("\n–í—ã —É–≤–µ—Ä–µ–Ω—ã? (y/N): ").strip().lower()
        if confirm != 'y':
            print_colored("‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ", 'yellow')
            return False
    except KeyboardInterrupt:
        print_colored("\n‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ", 'yellow')
        return False
    
    # –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
    removed_files = []
    for file in files_to_remove:
        try:
            if os.path.exists(file) or os.path.islink(file):
                if os.path.islink(file):
                    os.unlink(file)
                else:
                    os.remove(file)
                removed_files.append(file)
                print_colored(f"‚úÖ –£–¥–∞–ª–µ–Ω: {file}", 'green')
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {file}: {e}", 'red')
    
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥
    if user_config.exists():
        try:
            remove_user_config = input(f"\n–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥ {user_config}? (y/N): ").strip().lower()
            if remove_user_config == 'y':
                user_config.unlink()
                print_colored(f"‚úÖ –£–¥–∞–ª–µ–Ω: {user_config}", 'green')
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {user_config}: {e}", 'red')
    
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –ø–ª–∞–≥–∏–Ω—ã
    if plugins_dir.exists():
        try:
            remove_plugins = input(f"\n–£–¥–∞–ª–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–ª–∞–≥–∏–Ω–æ–≤ {plugins_dir}? (y/N): ").strip().lower()
            if remove_plugins == 'y':
                shutil.rmtree(plugins_dir)
                print_colored(f"‚úÖ –£–¥–∞–ª–µ–Ω: {plugins_dir}", 'green')
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {plugins_dir}: {e}", 'red')
    
    print_colored(f"\n‚úÖ –£–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: {len(removed_files)}", 'green')
    print_colored("üéØ –ü—Ä–æ–≥—Ä–∞–º–º–∞ —É–¥–∞–ª–µ–Ω–∞. –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫.", 'blue')
    return True

def show_version():
    """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏"""
    print_colored(f"Ping Status Monitor v{__version__}", 'cyan')
    print_colored(f"–ê–≤—Ç–æ—Ä: {__author__}", 'blue')
    print_colored("GitHub: https://github.com/hairpin01/ping-status", 'blue')

def get_plugin_help(plugin_name=None):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –ø–ª–∞–≥–∏–Ω–∞–º"""
    plugins_dir = Path.home() / '.config' / 'ping-status' / 'plugins'
    plugins_dir.mkdir(parents=True, exist_ok=True)
    
    print_colored("üîß Plugin Help System", 'cyan')
    print()
    
    if plugin_name:
        # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞
        plugin_files = list(plugins_dir.glob('*.py'))
        plugin_file = None
        
        # –ò—â–µ–º –ø–ª–∞–≥–∏–Ω –ø–æ —Ç–æ—á–Ω–æ–º—É –∏–º–µ–Ω–∏ –∏–ª–∏ –ø–æ —á–∞—Å—Ç–∏ –∏–º–µ–Ω–∏
        for pf in plugin_files:
            if pf.stem == plugin_name or pf.stem.replace('.plugin', '') == plugin_name:
                plugin_file = pf
                break
        
        if not plugin_file:
            print_colored(f"‚ùå –ü–ª–∞–≥–∏–Ω '{plugin_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω", 'red')
            return False
        
        try:
            spec = importlib.util.spec_from_file_location(plugin_file.stem, plugin_file)
            plugin_module = importlib.util.module_from_spec(spec)
            spec.loader.exec_module(plugin_module)
            
            if hasattr(plugin_module, 'get_help'):
                help_text = plugin_module.get_help()
                print_colored(f"üì¶ Plugin: {plugin_file.stem}", 'yellow')
                print(help_text)
            else:
                print_colored(f"‚ùå –ü–ª–∞–≥–∏–Ω '{plugin_file.stem}' –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø—Ä–∞–≤–∫–∏", 'red')
                
        except Exception as e:
            print_colored(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ {plugin_file.stem}: {e}", 'red')
            
    else:
        # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –∫—Ä–∞—Ç–∫—É—é —Å–ø—Ä–∞–≤–∫—É
        plugins_found = False
        
        for plugin_file in plugins_dir.glob('*.py'):
            plugins_found = True
            
            try:
                spec = importlib.util.spec_from_file_location(plugin_file.stem, plugin_file)
                plugin_module = importlib.util.module_from_spec(spec)
                spec.loader.exec_module(plugin_module)
                
                print_colored(f"üì¶ {plugin_file.stem}", 'yellow')
                
                if hasattr(plugin_module, 'get_help'):
                    help_text = plugin_module.get_help()
                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
                    first_line = help_text.strip().split('\n')[0]
                    print_colored(f"   {first_line}", 'blue')
                else:
                    print_colored("   No help available", 'red')
                    
                print()
                
            except Exception as e:
                print_colored(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ {plugin_file.stem}: {e}", 'red')
        
        if not plugins_found:
            print_colored("üì≠ –ü–ª–∞–≥–∏–Ω—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã", 'yellow')
            print_colored("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω—ã —Å –ø–æ–º–æ—â—å—é:", 'blue')
            print_colored("  ping-status --install-plugin <name>", 'green')
            print_colored("  ping-status --list-plugins", 'green')
        
        print_colored("–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å–ø—Ä–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:", 'cyan')
        print_colored("  ping-status --plugin-help <plugin_name>", 'green')

def get_available_themes():
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º –∏–∑ GitHub"""
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º GitHub API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ themes
        api_url = "https://api.github.com/repos/hairpin01/ping-status/contents/themes"
        with urllib.request.urlopen(api_url) as response:
            contents = json.loads(response.read().decode('utf-8'))
        
        themes = {}
        for item in contents:
            if item['name'].endswith('.conf'):
                theme_name = item['name'].replace('.conf', '')
                themes[theme_name] = item['download_url']
        
        return themes
    except Exception as e:
        print_colored(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–µ–º: {e}", 'red')
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        return {
            "minimal": f"{THEMES_BASE_URL}minimal.conf",
            "detailed": f"{THEMES_BASE_URL}detailed.conf",
            "modern": f"{THEMES_BASE_URL}modern.conf",
            "classic": f"{THEMES_BASE_URL}classic.conf",
            "terminal": f"{THEMES_BASE_URL}terminal.conf"
        }

def list_themes():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–º"""
    print_colored("üé® –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–µ–º...", 'yellow')
    themes = get_available_themes()
    
    print_colored("üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã:", 'cyan')
    for theme_name in sorted(themes.keys()):
        print_colored(f"  {theme_name}", 'blue')
    
    print()
    print_colored("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ping-status --theme <–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç–µ–º—ã>", 'green')
    print_colored("–ò–ª–∏: ping-status --theme-url <URL_—Ç–µ–º—ã>", 'green')

def apply_theme(theme_name):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –ø–æ –∏–º–µ–Ω–∏"""
    themes = get_available_themes()
    
    if theme_name not in themes:
        print_colored(f"‚ùå –¢–µ–º–∞ '{theme_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", 'red')
        print_colored("–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã:", 'yellow')
        list_themes()
        return False
    
    theme_url = themes[theme_name]
    return apply_theme_from_url(theme_url, theme_name)

def apply_theme_from_url(theme_url, theme_name="custom"):
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –∏–∑ URL"""
    print_colored(f"üé® –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã '{theme_name}'...", 'yellow')
    
    try:
        # –°–∫–∞—á–∞—Ç—å —Ç–µ–º—É
        with urllib.request.urlopen(theme_url) as response:
            theme_content = response.read().decode('utf-8')
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é —Ç–µ–º—ã
        config = configparser.ConfigParser()
        try:
            config.read_string(theme_content)
            if config.has_section('compatibility'):
                min_version = config.get('compatibility', 'min_version', fallback='')
                if min_version and not version_check(min_version, f"Theme '{theme_name}'"):
                    return False
        except:
            pass  # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ñ–∏–≥
        user_config_path = Path.home() / '.config' / 'ping-status.conf'
        user_config_path.parent.mkdir(exist_ok=True)
        
        # –°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
        if user_config_path.exists():
            backup_path = user_config_path.with_suffix('.conf.backup')
            shutil.copy2(str(user_config_path), str(backup_path))
            print_colored(f"üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø: {backup_path}", 'blue')
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É
        with open(user_config_path, 'w') as f:
            f.write(theme_content)
        
        print_colored(f"‚úÖ –¢–µ–º–∞ '{theme_name}' —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!", 'green')
        return True
        
    except Exception as e:
        print_colored(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã: {e}", 'red')
        return False

def get_available_plugins():
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏–∑ GitHub"""
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º GitHub API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ plugins
        api_url = "https://api.github.com/repos/hairpin01/ping-status/contents/plugins"
        with urllib.request.urlopen(api_url) as response:
            contents = json.loads(response.read().decode('utf-8'))
        
        plugins = {}
        for item in contents:
            if item['name'].endswith('.py'):
                plugin_name = item['name'].replace('.py', '')
                plugins[plugin_name] = item['download_url']
        
        return plugins
    except Exception as e:
        print_colored(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤: {e}", 'red')
        return {}

def list_plugins():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤"""
    print_colored("üîå –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤...", 'yellow')
    plugins = get_available_plugins()
    
    if not plugins:
        print_colored("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤", 'red')
        return
    
    print_colored("üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:", 'cyan')
    for plugin_name in sorted(plugins.keys()):
        print_colored(f"  {plugin_name}", 'blue')
    
    print()
    print_colored("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ping-status --install-plugin <–Ω–∞–∑–≤–∞–Ω–∏–µ_–ø–ª–∞–≥–∏–Ω–∞>", 'green')

def install_plugin(plugin_name):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω –ø–æ –∏–º–µ–Ω–∏"""
    plugins = get_available_plugins()
    
    if plugin_name not in plugins:
        print_colored(f"‚ùå –ü–ª–∞–≥–∏–Ω '{plugin_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω", 'red')
        print_colored("–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:", 'yellow')
        list_plugins()
        return False
    
    plugin_url = plugins[plugin_name]
    return install_plugin_from_url(plugin_url, plugin_name)

def install_plugin_from_url(plugin_url, plugin_name="custom"):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω –∏–∑ URL"""
    print_colored(f"üîå –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ '{plugin_name}'...", 'yellow')
    
    try:
        # –°–∫–∞—á–∞—Ç—å –ø–ª–∞–≥–∏–Ω
        with urllib.request.urlopen(plugin_url) as response:
            plugin_content = response.read().decode('utf-8')
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–ª–∞–≥–∏–Ω–æ–≤
        plugins_dir = Path.home() / '.config' / 'ping-status' / 'plugins'
        plugins_dir.mkdir(parents=True, exist_ok=True)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .plugin.py –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
        plugin_path = plugins_dir / f"{plugin_name}.plugin.py"
        
        # –°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–ª–∞–≥–∏–Ω–∞
        if plugin_path.exists():
            backup_path = plugin_path.with_suffix('.py.backup')
            shutil.copy2(str(plugin_path), str(backup_path))
            print_colored(f"üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø: {backup_path}", 'blue')
        
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω
        with open(plugin_path, 'w') as f:
            f.write(plugin_content)
        
        print_colored(f"‚úÖ –ü–ª–∞–≥–∏–Ω '{plugin_name}' —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!", 'green')
        
        # –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É –ø–ª–∞–≥–∏–Ω—É
        print_colored("\nüìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ –ø–ª–∞–≥–∏–Ω—É:", 'cyan')
        get_plugin_help(plugin_name)
        
        return True
        
    except Exception as e:
        print_colored(f"‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–∞: {e}", 'red')
        return False

def main():
    parser = argparse.ArgumentParser(description='Ping Status Monitor')
    parser.add_argument('--version', '-v', action='store_true', help='–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é')
    parser.add_argument('--check-update', action='store_true', help='–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è')
    parser.add_argument('--update', action='store_true', help='–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É')
    parser.add_argument('--uninstall', action='store_true', help='–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É')
    parser.add_argument('--list-themes', action='store_true', help='–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–µ–º')
    parser.add_argument('--theme', help='–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –ø–æ –∏–º–µ–Ω–∏')
    parser.add_argument('--theme-url', help='–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ–º—É –∏–∑ URL')
    parser.add_argument('--list-plugins', action='store_true', help='–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤')
    parser.add_argument('--install-plugin', help='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω –ø–æ –∏–º–µ–Ω–∏')
    parser.add_argument('--plugin-url', help='–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω –∏–∑ URL')
    parser.add_argument('--plugin-help', nargs='?', const='', help='–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –ø–ª–∞–≥–∏–Ω–∞–º')
    
    args = parser.parse_args()
    
    if args.version:
        show_version()
    elif args.check_update:
        check_update()
    elif args.update:
        perform_update()
    elif args.uninstall:
        uninstall()
    elif args.list_themes:
        list_themes()
    elif args.theme:
        apply_theme(args.theme)
    elif args.theme_url:
        apply_theme_from_url(args.theme_url, "custom")
    elif args.list_plugins:
        list_plugins()
    elif args.install_plugin:
        install_plugin(args.install_plugin)
    elif args.plugin_url:
        install_plugin_from_url(args.plugin_url, "custom")
    elif args.plugin_help is not None:
        if args.plugin_help == '':
            get_plugin_help()
        else:
            get_plugin_help(args.plugin_help)
    else:
        show_status()

if __name__ == '__main__':
    main()
